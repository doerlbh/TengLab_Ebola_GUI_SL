% developed by Baihan Lin
% Ebola Modeling
% Data Fitting

% % To Do:
% 1. Open Excel
% 2. Read Data
% 3. Plot Data
% 4. Fit Model
% 5. Fit Parameters
% 6. Plot Model and Data

clear all;
close all;

filename = '/Users/DoerLBH/Dropbox/git/TengLab_Ebola_GUI_SL/Table1_for_code.xlsx';
xlRange = 'A2:E18';
GUI = xlsread(filename,1,xlRange);
SL  = xlsread(filename,2,xlRange);

t = 1:17;
GCase  = GUI(:, 2);
SCase  =  SL(:, 2);
GDeath = GUI(:, 3);
SDeath =  SL(:, 3);
GInf   = GUI(:, 4);
SInf   =  SL(:, 4);
GCFR   = GUI(:, 5);
SCFR   =  SL(:, 5);

fig1 = figure;
plot(t, GInf, 'red', 'LineWidth', 2); hold on
plot(t, SInf, 'blue', 'LineWidth', 2);
plot(t, GDeath, 'red--', 'LineWidth', 2);
plot(t, SDeath, 'blue--', 'LineWidth', 2);
title('Infectious & Death in GUI and SL');
xlabel('month');
ylabel('number');
legend('GInf','SInf', 'GDeath', 'SDeath','Location','northwest');
% close(fig1);

% For GUI

% Initial conditions: 1997 susceptible, 2 infected, 0 recovered
y0 = [1997 3 0];

% tspan will hold the times for which to solve the system
% of ODEs. We want to solve it at the times that
% correspond to our data
tspan = t;

% Try solving the system at a guess for good parameter values
p0 = [.01 .1];

Gp_opt = sir_optimize(GInf.', GDeath.', tspan, y0, p0);

[t,Gy] = ode45(@sir_ode, tspan, y0, [], Gp_opt);

fig2 = figure;
plot(t, Gy(:,1), 'linewidth', 2);
plot(t, Gy(:,2), 'orange', 'linewidth', 2);
plot(t, Gy(:,3), 'g', 'linewidth', 2);
hold on;
plot(t, GInf, 'orange*', 'markersize', 10);
plot(t, GDeath, 'g+', 'markersize', 10);
title('Prediction & Data in GUI');
xlabel('month');
ylabel('number');
legend('Pre-S', 'Pre-I', 'Pre-R', 'GInf', 'GDeath', 'Location', 'northwest');
set(gca, 'FontSize', 15);
% close(fig2);


% For SL

% Initial conditions: 9997 susceptible, 3 infected, 0 recovered
y0 = [9997 3 0];

% tspan will hold the times for which to solve the system
% of ODEs. We want to solve it at the times that
% correspond to our data
tspan = t;

% Try solving the system at a guess for good parameter values
p0 = [.01 .1];

Sp_opt = sir_optimize(SInf.', SDeath.', tspan, y0, p0);

[t,Sy] = ode45(@sir_ode, tspan, y0, [], Sp_opt);

fig3 = figure;
plot(t, Sy, 'linewidth', 2);
hold on;
plot(t, SInf, 'k*', 'markersize', 10);
plot(t, SDeath, 'k+', 'markersize', 10);
title('Prediction & Data in SL');
xlabel('month');
ylabel('number');
legend('Pre-S', 'Pre-I', 'Pre-R', 'SInf', 'SDeath', 'Location', 'northwest');
set(gca, 'FontSize', 15);
% close(fig3);
